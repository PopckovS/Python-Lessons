Django + Celery
---
**Celery** - нужен для запуска задач в отдельном рабочем
процессе (worker), что позволяет немедленно отправить HTTP-ответ
пользователю в веб-процессе (даже если задача в рабочем процессе
все еще выполняется). Цикл обработки запроса не будет заблокирован,
что повысит качество взаимодействия с пользователем.

**worker** - отдельный рабочий процесс, который берется за 
выполнение некой задачи в фоновом режиме. 

Варианты использования:

- Обработка отправки 10 электронных писем, В данном случае Celery
может организовать отправку писем в фоновом режиме, что в свою
очередь позволит вернуть HTTP-ответ пользователю без ожидания.

- Необходимо делать что-то периодически, например, генерировать
ежедневный отчет, очищать данные истекшей сессии.

Сельдерей требует решения для отправки и получения сообщений,
обычно это осуществляется в виде отдельной службы, называемой
брокером сообщений.

Существует 2 брокера сообщений для работы с Celery:

1. Celery 
2. RQ (Redis Queue)

---

Брокеры сообщений.
---

Брокер сообщений — это хранилище, которое играет роль транспорта
между производителем и потребителем. Из документации Celery
рекомендуемым брокером является RabbitMQ, потому что он поддерживает
AMQP (расширенный протокол очереди сообщений).

Так как во многих случаях нам не нужно использовать AMQP, другой 
диспетчер очереди, такой как Redis, также подойдет. 

Бэкенд результатов — это хранилище, которое содержит информацию
о результатах выполнения Celery-задач и о возникших ошибках.

Брокеры сообщений используемые Celery:

1. Redis
2. RabbitMQ

---

Redis
---

Стандартно Redis запускается на `127.0.0.1:6379` 

Можно использовать как Redis в основной системе, так и в контейнере
Docker следующим образом

    docker run -d -p 6379:6379 redis

Установка Redis 

    sudo apt install redis-server

Запуск Redis и добавление в автозагрузку

    sudo systemctl start redis-server
    sudo systemctl enable redis-server

Узнать версию 

    redis-server --version

Проверить, состояние сервера

    service redis status

Остановка сервера

    service redis stop

Запуск сервера

    service redis start

---

flower
---

Flower – это легкий веб-инструмент для мониторинга Celery в 
режиме реального времени. Вы можете отслеживать запущенные
задания, увеличивать или уменьшать пул воркеров, отображать
графики и статистику.

---

Celery начало работы
---

Установка пакетов для работы Celery

    pip3 install celery==4.4.7 redis==3.5.3 flower==0.9.7

Или установка Celery совместно с другими пакетами для работы.

Для использования Redis в качестве транспорта сообщений 
или в качестве бэкэнда:

    pip3 install "celery[redis]"

Или в место Redis используем RabbitMQ 

    pip3 install "celery[librabbitmq]"

---







































