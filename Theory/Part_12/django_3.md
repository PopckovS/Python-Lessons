База данных, модели, миграции и подключение моделей к админке.
---
---

ORM (Object-Relation Mapping) - обьектно-реляционное отображение, суть 
данной системы заключается в представлении таблиц БД, в качестве классов
программного кода, и инкапсуляции самого кода от конкретной СУБД, это 
своего рода прослойка между кодом и таблицами, для одинаковой работы с
любой СУБД.

В файле настроек `<project_name>/settings.py` определение с какой Бд будем 
работать, описывается в настройке `DATABASES`, с параметрами для работы,

Начальные настройки для подключения к БД :
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```
В этом словаре с настройками можно увидеть ряд параметров, рассмотрим 
эти параметры подробнее:

1) `ENGINE` - указывает СУБД с которой будем работать, для разных СУБД 
параметры разные:

```
    'django.db.backends.sqlite3'
    'django.db.backends.postgresql'
    'django.db.backends.mysql'
```

2) `NAME` - это название БД, если используется `SQLite` то указывается
полный путь к файлу, для указания на корень проекта в `settings.py`
самим Django предопределена специальная константа `BASE_DIR` которая
указывает на корень проекта.

В зависимости от выбранной СУБД количество настроек будет разным, для 
`sqlite3` статочно таких:

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
      
        # В корне проекта лежит файл с БД sqlite3 
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

Для использования PostgreSQL параметры будут другими:

```python
        DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.postgresql',
            'NAME': 'lessons-django',
            'USER': 'serg',
            'PASSWORD': '11',
            'HOST': '127.0.0.1',
            'PORT': '8000',
        }
    }
```

---
Начальная Миграция
---

В настройке `INSTALLED_APPS` по дефолту определены приложения для 
стандартной работы сайта, также мы и сами создаем и подключаем свои 
приложения, все эти приложения имеют свои модели, для того чтобы создать 
все эти таблицы, требуется запустить команду:

```
python3 manage.py migrate
```

`migrate` - команда просматривает все подключенные приложения и анализирует
модели в приложениях, если находит еще не примененные миграции то запускает 
их.

---
Создание моделей
---
Скажем мы хотим создать приложение `polls` которое будет создавать опрос
пользователей, нам потребуется создать 2 модели в приложении `polls`

1) Модель `Question` будет содержать 2 поля, Вопрос и Дату публикации. 

2) Модель `Choice` будет содержать 2 поля, Текст выбора и Подсчет голосов,
каждый `Choice` связан с `Question`.

В файле `polls/models.py` создадим наши модели, каждая модель будет 
задаваться как класс с именем в соответствии с таблицей в БД.

Тут все взаимодействие происходит через класс models, каждая модель 
наследуется от `django.db.models.Model` каждое свойство(поле) данного класса
реализуется как столбец таблицы и как класс наследуемый от `models`.

Каждое поле представлено своим классом:
   
1. `models.CharField` - реализует тип данных char
2. `models.DateTimeField` - дата/время
3. `models.ForeignKey` - внешний ключ
4. `models.IntegerField` - целое число

Обратим внимание, что мы не задаем первичный ключ в каждой из моделей,
он будет создан автоматически.

```python
# импорт модуля для создания моделей
from django.db import models

# модель для вопросов с 2 полями
class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')

# дель для выборов опросов
class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
```

