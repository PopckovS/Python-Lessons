`OSM geocoder` поиск в установленном радиусе полигона
---

В `GIS` для указания площади поиска в полигоне задается 2 точками,
левой нижней точкой и правой верхней, так 4 координаты задают 2 
точки по которым и выстраивается полигон в площади которого и 
будет вестись поиск.

При поиске координат по адресу с помощью `OSM` можно устанавливать 
радиус поиска координат, к примеру радиус поиска в городе Воронеж 
будет задан следующими координатами.

```python
# Радиусе в рамках которого будет вестись поиск координат для сообщений 112
GEO_RADIUS_FOR_SEARCH = {
    'Воронеж': ['39.0130423503482', '51.483114965548', '39.65899999999999', '51.902863']
}
```

`OSM` для поиска используем точку входа в `API`   

```python
OSM_BASE_URL = "https://nominatim.openstreetmap.org/search.php"
```

Напишем функцию, которая будет искать адрес в указанном полигоне города Воронеж.

Параметры `get` запроса к точке `API` :

- `viewbox` это и есть наш полигон для поиска в его площади
- `q` адрес для которого ищем гео-координаты
- `format=jsonv2` формат в которых возвращаемых значений, `python` удобно работать с
`json` ибо он легко конвертируется в словари
- `bounded=1` по дефолту даже если вы указываете радиус поиска `viewbox` работать 
он не будет, требуется указать `bounded=1` чтобы радиус координат начался именно в
указанном полигоне
- `limit=1` по дефолту `OSM` возвращает все найденные адреса, этот параметр указывает
до скольки совпадений следует возвращать

```python
def osm_geocoder(address: str, search_radius: list = []) -> dict:
    """С помощью гео-кодера OSM получает координаты по адресу"""
    
    # формируем параметры для запрсоа на точку API
    source = '{url}?viewbox={search_radius}&q={address}&format=jsonv2&bounded=1&limit=1'.format(
        url=settings.OSM_BASE_URL, 
        search_radius=','.join(search_radius), 
        address=address
    )
    
    # делаем запрос стандартной бибилиотекой 
    geo = requests.get(source)
    
    # конвертируем в словарь первый эллемент там и находятся координаты
    geo =  dict(geo.json()[0])
    
    # возвращаем координаты
    return geo["lon"], geo["lat"]
    

lon, lat = osm_geocoder(
                    'Воронеж Перхоровича дом 59', 
                    settings.GEO_RADIUS_FOR_SEARCH['Воронеж']
            )
```

Помните: 
- `OSM` бесплатна и по тому плохо парсит адреса, нормализуйте ваши адреса перед отправкой
- `OSM` работает довольно медленно, по сравнению с `Yandex Geocoder`
(1000 бесплатных запросов в день) но зато бесплатно и без ограничений


